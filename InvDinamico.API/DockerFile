# syntax=docker/dockerfile:1

# Stage 1: Build
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# Copy all .csproj files first for efficient caching.
# These paths match your screenshot.
COPY ["InvDinamico.API/InvDinamico.API.csproj", "InvDinamico.API/"]
COPY ["InvDinamico.Domain/InvDinamico.Domain.csproj", "InvDinamico.Domain/"]

# Restore NuGet packages
RUN dotnet restore "InvDinamico.API/InvDinamico.API.csproj"

# Copy all the source code
COPY . .

# Publish the application
WORKDIR "/src/InvDinamico.API"
RUN dotnet publish "InvDinamico.API.csproj" -c Release -o /app/publish

# ---

# Stage 2: Final Image
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS final
WORKDIR /app
COPY --from=build /app/publish .
EXPOSE 8080
ENV ASPNETCORE_URLS=http://+:8080
ENTRYPOINT ["dotnet", "InvDinamico.API.dll"]